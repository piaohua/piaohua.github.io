<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>[Go] go-micro 使用入门 - piaohua&#39;s blog</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="piaohua" /><meta name="description" content="go-micro 入门 go-micro是一个简化分布式开发的微服务生态系统，该系统为开发分布式应用程序提供了高效，便捷的模块构建。主要目的是简化分布式系统的" /><meta name="keywords" content="Hugo, theme, even" />






<meta name="generator" content="Hugo 0.67.0 with theme even" />


<link rel="canonical" href="https://piaohua.github.io/post/golang/20250408-go-micro-start/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.2e81bbed97b8b282c1aeb57488cc71c8d8c8ec559f3931531bd396bf31e0d4dd.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="[Go] go-micro 使用入门" />
<meta property="og:description" content="go-micro 入门 go-micro是一个简化分布式开发的微服务生态系统，该系统为开发分布式应用程序提供了高效，便捷的模块构建。主要目的是简化分布式系统的" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://piaohua.github.io/post/golang/20250408-go-micro-start/" />
<meta property="article:published_time" content="2025-04-08T12:01:47+08:00" />
<meta property="article:modified_time" content="2025-04-08T12:01:47+08:00" />
<meta itemprop="name" content="[Go] go-micro 使用入门">
<meta itemprop="description" content="go-micro 入门 go-micro是一个简化分布式开发的微服务生态系统，该系统为开发分布式应用程序提供了高效，便捷的模块构建。主要目的是简化分布式系统的">
<meta itemprop="datePublished" content="2025-04-08T12:01:47&#43;08:00" />
<meta itemprop="dateModified" content="2025-04-08T12:01:47&#43;08:00" />
<meta itemprop="wordCount" content="2058">



<meta itemprop="keywords" content="golang,go-micro,micro," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="[Go] go-micro 使用入门"/>
<meta name="twitter:description" content="go-micro 入门 go-micro是一个简化分布式开发的微服务生态系统，该系统为开发分布式应用程序提供了高效，便捷的模块构建。主要目的是简化分布式系统的"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">piaohua</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/links/">
        <li class="mobile-menu-item">Links</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">piaohua</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/links/">Links</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">[Go] go-micro 使用入门</h1>

      <div class="post-meta">
        <span class="post-time"> 2025-04-08 </span>
        <div class="post-category">
            <a href="/categories/golang/"> golang </a>
            </div>
          <span class="more-meta"> 2058 words </span>
          <span class="more-meta"> 5 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#特征">特征</a></li>
    <li><a href="#micro微服务工具包">micro微服务工具包</a>
      <ul>
        <li><a href="#install-micro-cli">Install Micro CLI</a></li>
        <li><a href="#usage">Usage</a></li>
        <li><a href="#run-the-server">Run the server</a></li>
        <li><a href="#login-to-micro">Login to Micro</a></li>
        <li><a href="#run-the-service">Run the service</a></li>
      </ul>
    </li>
    <li><a href="#go-micro入门">go-micro入门</a></li>
    <li><a href="#参考">参考</a></li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <blockquote>
<p><a href="https://github.com/micro/go-micro">go-micro</a> 入门</p>
</blockquote>
<p><a href="https://github.com/micro/go-micro">go-micro</a>是一个简化分布式开发的微服务生态系统，该系统为开发分布式应用程序提供了高效，便捷的模块构建。主要目的是简化分布式系统的开发，包括RPC和事件驱动通信，合理的默认值和可插拨的架构。</p>
<h2 id="特征">特征</h2>
<ul>
<li>
<p><strong>身份验证</strong>- Auth 是内置的，是一等公民。身份验证和授权通过为每项服务提供身份和证书来实现安全的零信任网络。这还包括基于规则的访问控制。</p>
</li>
<li>
<p><strong>动态配置</strong>- 从任意位置加载和热重载动态配置。配置接口提供了一种从任何来源（例如环境变量、文件、etcd）加载应用程序级配置的方法。您可以合并源，甚至可以定义后备方案。</p>
</li>
<li>
<p><strong>数据存储</strong>- 一个简单的数据存储接口，用于读取、写入和删除记录。它包括对插件库中许多存储后端的支持。状态和持久性成为原型设计之外的核心要求，Micro 希望将其构建到框架中。</p>
</li>
<li>
<p><strong>服务发现</strong>- 自动服务注册和名称解析。服务发现是微服务开发的核心。当服务 A 需要与服务 B 通信时，它需要该服务的位置。默认发现机制是多播 DNS (mdns)，这是一种零配置系统。</p>
</li>
<li>
<p><strong>负载平衡</strong>- 基于服务发现的客户端负载平衡。一旦我们获得了某个服务任意数量的实例的地址，我们现在需要一种方法来决定路由到哪个节点。我们使用随机散列负载平衡来提供跨服务的均匀分布，并在出现问题时重试其他节点。</p>
</li>
<li>
<p><strong>消息编码</strong>- 基于内容类型的动态消息编码。客户端和服务器将使用编解码器以及内容类型为您无缝编码和解码 Go 类型。任何种类的消息都可以从不同的客户端进行编码和发送。客户端和服务器默认处理此问题。默认情况下，这包括 protobuf 和 json。</p>
</li>
<li>
<p><strong>RPC 客户端/服务器</strong>- 基于 RPC 的请求/响应，支持双向流式传输。我们为同步通信提供抽象。对服务的请求将自动解析、负载平衡、拨号和流式传输。</p>
</li>
<li>
<p><strong>异步消息传递</strong>- PubSub 是异步通信和事件驱动架构的首选。事件通知是微服务开发的核心模式。默认消息传递系统是 HTTP 事件消息代理。</p>
</li>
<li>
<p><strong>可插入接口</strong>- Go Micro 利用 Go 接口实现每个分布式系统抽象。因此，这些接口是可插入的，并允许 Go Micro 不受运行时限制。您可以插入任何底层技术。</p>
</li>
</ul>
<h2 id="micro微服务工具包">micro微服务工具包</h2>
<p>工具包组成</p>
<p><img src="https://github.com/rubyhan1314/Golang-100-Days/raw/master/Day83-85(go-micro%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%A1%86%E6%9E%B6)/img/micro%E5%B9%B3%E5%8F%B0%E7%BB%84%E6%88%90.png" alt="" title="micro"></p>
<ul>
<li>
<p><strong>Go Micro</strong>：用于在Go中编写微服务的插件式RPC框架。它提供了用于服务发现，客户端负载平衡，编码，同步和异步通信库。</p>
</li>
<li>
<p><strong>API：</strong> API主要负责提供将HTTP请求路由到相应微服务的API网关。它充当单个入口点，可以用作反向代理或将HTTP请求转换为RPC。</p>
</li>
<li>
<p><strong>Sidecar</strong>：一种对语言透明的RPC代理，具有go-micro作为HTTP端点的所有功能。虽然Go是构建微服务的伟大语言，但您也可能希望使用其他语言，因此Sidecar提供了一种将其他应用程序集成到Micro世界的方法。</p>
</li>
<li>
<p><strong>Web</strong>：用于Micro Web应用程序的仪表板和反向代理。我们认为应该基于微服务建立web应用，因此被视为微服务领域的一等公民。它的行为非常像API反向代理，但也包括对web sockets的支持。</p>
</li>
<li>
<p><strong>CLI</strong>：一个直接的命令行界面来与你的微服务进行交互。它还使您可以利用Sidecar作为代理，您可能不想直接连接到服务注册表。</p>
</li>
<li>
<p><strong>Bot</strong>：Hubot风格的bot，位于您的微服务平台中，可以通过Slack，HipChat，XMPP等进行交互。它通过消息传递提供CLI的功能。可以添加其他命令来自动执行常见的操作任务。</p>
</li>
</ul>
<h3 id="install-micro-cli">Install Micro CLI</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">go install github.com/micro/micro/v5/cmd/micro@master
</code></pre></td></tr></table>
</div>
</div><p>安装成功后查看</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">&gt; micro -v
micro version latest
</code></pre></td></tr></table>
</div>
</div><h3 id="usage">Usage</h3>
<p>设置环境，当前设置为本地环境运行</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">micro env <span class="nb">set</span> <span class="nb">local</span>

<span class="c1"># 查看当前环境</span>
micro env get
</code></pre></td></tr></table>
</div>
</div><h3 id="run-the-server">Run the server</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">➜  ~ micro server
2025-04-08 12:43:03  <span class="nv">file</span><span class="o">=</span>server/server.go:74 <span class="nv">level</span><span class="o">=</span>info Starting server
2025-04-08 12:43:03  <span class="nv">file</span><span class="o">=</span>server/server.go:129 <span class="nv">level</span><span class="o">=</span>info Registering registry
2025-04-08 12:43:03  <span class="nv">file</span><span class="o">=</span>server/server.go:129 <span class="nv">level</span><span class="o">=</span>info Registering broker
2025-04-08 12:43:03  <span class="nv">file</span><span class="o">=</span>server/server.go:129 <span class="nv">level</span><span class="o">=</span>info Registering network
2025-04-08 12:43:03  <span class="nv">file</span><span class="o">=</span>server/server.go:129 <span class="nv">level</span><span class="o">=</span>info Registering runtime
2025-04-08 12:43:03  <span class="nv">file</span><span class="o">=</span>server/server.go:129 <span class="nv">level</span><span class="o">=</span>info Registering config
2025-04-08 12:43:03  <span class="nv">file</span><span class="o">=</span>server/server.go:129 <span class="nv">level</span><span class="o">=</span>info Registering store
2025-04-08 12:43:03  <span class="nv">file</span><span class="o">=</span>server/server.go:129 <span class="nv">level</span><span class="o">=</span>info Registering events
2025-04-08 12:43:03  <span class="nv">file</span><span class="o">=</span>server/server.go:129 <span class="nv">level</span><span class="o">=</span>info Registering auth
2025-04-08 12:43:03  <span class="nv">file</span><span class="o">=</span>server/server.go:139 <span class="nv">level</span><span class="o">=</span>info Starting runtime
2025-04-08 12:43:03  <span class="nv">file</span><span class="o">=</span>grpc/grpc.go:993 <span class="nv">level</span><span class="o">=</span>info Server <span class="o">[</span>grpc<span class="o">]</span> Listening on <span class="o">[</span>::<span class="o">]</span>:8081
2025-04-08 12:43:03  <span class="nv">file</span><span class="o">=</span>http/http.go:93 <span class="nv">level</span><span class="o">=</span>info HTTP Server Listening on <span class="o">[</span>::<span class="o">]</span>:8080
</code></pre></td></tr></table>
</div>
</div><p>可以看到默认监听了8081和8080端口，分别用于grpc和http通信。</p>
<p>命令行访问验证：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">➜  ~ curl <span class="s2">&#34;http://localhost:8080&#34;</span>
<span class="o">{</span><span class="s2">&#34;version&#34;</span>: <span class="s2">&#34;latest&#34;</span><span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="login-to-micro">Login to Micro</h3>
<p>Default username/password: <code>admin/micro</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">$ micro login
Enter username: admin
Enter password:
Successfully logged in.
</code></pre></td></tr></table>
</div>
</div><h3 id="run-the-service">Run the service</h3>
<p>查看当前服务运行状态，默认运行一个helloworld服务。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">➜  ~ micro status
NAME            VERSION SOURCE          STATUS  BUILD   UPDATED         METADATA
helloworld      latest  helloworld      running n/a     3d18h22m22s ago <span class="nv">owner</span><span class="o">=</span>admin, <span class="nv">group</span><span class="o">=</span>micro
</code></pre></td></tr></table>
</div>
</div><p>查看当前运行中的服务</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">➜  ~ micro services
auth
broker
config
events
helloworld
network
registry
runtime

</code></pre></td></tr></table>
</div>
</div><p>运行一个本地自建服务，比如运行id服务：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">git clone https://github.com/micro/services.git

<span class="nb">cd</span> services

micro run id
</code></pre></td></tr></table>
</div>
</div><p>查看运行服务状态</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">➜  micro status
NAME            VERSION SOURCE          STATUS  BUILD   UPDATED         METADATA
helloworld      latest  helloworld      running n/a     3d18h27m31s ago <span class="nv">owner</span><span class="o">=</span>admin, <span class="nv">group</span><span class="o">=</span>micro
id              latest  id              running n/a     33s ago         <span class="nv">owner</span><span class="o">=</span>admin, <span class="nv">group</span><span class="o">=</span>micro

</code></pre></td></tr></table>
</div>
</div><p>通过htt访问指定服务：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">➜  curl <span class="s2">&#34;http://localhost:8080/id/Generate?type=snowflake&#34;</span>
<span class="o">{</span><span class="s2">&#34;id&#34;</span>:<span class="s2">&#34;1756205649227841536&#34;</span>,<span class="s2">&#34;type&#34;</span>:<span class="s2">&#34;snowflake&#34;</span><span class="o">}</span>%
➜  services git:<span class="o">(</span>master<span class="o">)</span> curl <span class="s2">&#34;http://localhost:8080/helloworld/Stream?name=John&#34;</span>
<span class="o">{</span><span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Hello John&#34;</span><span class="o">}</span>%
</code></pre></td></tr></table>
</div>
</div><p>通过grpc访问指定服务</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">➜  micro stream helloworld Helloworld.Stream <span class="s1">&#39;{&#34;name&#34;:&#34;John&#34;,&#34;messages&#34;:2}&#39;</span>
<span class="o">{</span>
        <span class="s2">&#34;message&#34;</span>: <span class="s2">&#34;Hello John&#34;</span>
<span class="o">}{</span>
        <span class="s2">&#34;message&#34;</span>: <span class="s2">&#34;Hello John&#34;</span>
<span class="o">}</span>%
</code></pre></td></tr></table>
</div>
</div><p>查看服务日志</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">micro logs helloworld
</code></pre></td></tr></table>
</div>
</div><p>停止一个服务</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">micro <span class="nb">kill</span> id
</code></pre></td></tr></table>
</div>
</div><p>停止micro server</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">micro shutdown
</code></pre></td></tr></table>
</div>
</div><h2 id="go-micro入门">go-micro入门</h2>
<p>创建一个micro服务，并在本地运行，代码实现如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;context&#34;</span>
	<span class="s">&#34;go-micro.dev/v5&#34;</span>
<span class="p">)</span>

<span class="kd">type</span> <span class="nx">Request</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">Name</span> <span class="kt">string</span> <span class="s">`json:&#34;name&#34;`</span>

<span class="p">}</span>

<span class="kd">type</span> <span class="nx">Response</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">Message</span> <span class="kt">string</span> <span class="s">`json:&#34;message&#34;`</span>

<span class="p">}</span>

<span class="kd">type</span> <span class="nx">Helloworld</span> <span class="kd">struct</span><span class="p">{}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">h</span> <span class="o">*</span><span class="nx">Helloworld</span><span class="p">)</span> <span class="nf">Greeting</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">req</span> <span class="o">*</span><span class="nx">Request</span><span class="p">,</span> <span class="nx">rsp</span> <span class="o">*</span><span class="nx">Response</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
	<span class="nx">rsp</span><span class="p">.</span><span class="nx">Message</span> <span class="p">=</span> <span class="s">&#34;Hello &#34;</span> <span class="o">+</span> <span class="nx">req</span><span class="p">.</span><span class="nx">Name</span>
	<span class="k">return</span> <span class="kc">nil</span>

<span class="p">}</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="c1">// create a new service
</span><span class="c1"></span>	<span class="nx">service</span> <span class="o">:=</span> <span class="nx">micro</span><span class="p">.</span><span class="nf">NewService</span><span class="p">(</span>
		<span class="nx">micro</span><span class="p">.</span><span class="nf">Name</span><span class="p">(</span><span class="s">&#34;helloworld&#34;</span><span class="p">),</span>
		<span class="nx">micro</span><span class="p">.</span><span class="nf">Handle</span><span class="p">(</span><span class="nb">new</span><span class="p">(</span><span class="nx">Helloworld</span><span class="p">)),</span>
		<span class="c1">// set address
</span><span class="c1"></span>		<span class="nx">micro</span><span class="p">.</span><span class="nf">Address</span><span class="p">(</span><span class="s">&#34;:8080&#34;</span><span class="p">),</span>
	<span class="p">)</span>

	<span class="c1">// initialise flags
</span><span class="c1"></span>	<span class="nx">service</span><span class="p">.</span><span class="nf">Init</span><span class="p">()</span>

	<span class="c1">// start the service
</span><span class="c1"></span>	<span class="nx">service</span><span class="p">.</span><span class="nf">Run</span><span class="p">()</span>
<span class="p">}</span>

</code></pre></td></tr></table>
</div>
</div><p>运行服务</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">o run main.go
2025-04-08 13:19:14  <span class="nv">file</span><span class="o">=</span>hi/main.go:39 <span class="nv">level</span><span class="o">=</span>info Starting <span class="o">[</span>service<span class="o">]</span> helloworld
2025-04-08 13:19:14  <span class="nv">file</span><span class="o">=</span>v5@v5.3.0/service.go:98 <span class="nv">level</span><span class="o">=</span>info Transport <span class="o">[</span>http<span class="o">]</span> Listening on <span class="o">[</span>::<span class="o">]</span>:8080
2025-04-08 13:19:14  <span class="nv">file</span><span class="o">=</span>v5@v5.3.0/service.go:98 <span class="nv">level</span><span class="o">=</span>info Broker <span class="o">[</span>http<span class="o">]</span> Connected to 127.0.0.1:58934
2025-04-08 13:19:14  <span class="nv">file</span><span class="o">=</span>server/rpc_server.go:562 <span class="nv">level</span><span class="o">=</span>info Registry <span class="o">[</span>mdns<span class="o">]</span> Registering node: helloworld-7b25c850-b353-461e-8e32-7ab4a9870ab3
</code></pre></td></tr></table>
</div>
</div><p>访问服务</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">~ curl -XPOST <span class="se">\
</span><span class="se"></span>     -H <span class="s1">&#39;Content-Type: application/json&#39;</span> <span class="se">\
</span><span class="se"></span>     -H <span class="s1">&#39;Micro-Endpoint: Helloworld.Greeting&#39;</span> <span class="se">\
</span><span class="se"></span>     -d <span class="s1">&#39;{&#34;name&#34;: &#34;alice&#34;}&#39;</span> <span class="se">\
</span><span class="se"></span>      http://localhost:8080
<span class="o">{</span><span class="s2">&#34;message&#34;</span>:<span class="s2">&#34;Hello alice&#34;</span><span class="o">}</span>

</code></pre></td></tr></table>
</div>
</div><h2 id="参考">参考</h2>
<ul>
<li><a href="https://github.com/micro/go-micro">go-micro</a></li>
<li><a href="https://github.com/micro/micro">micro</a></li>
<li><a href="https://github.com/rubyhan1314/Golang-100-Days/blob/master/Day83-85(go-micro%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%A1%86%E6%9E%B6)/day83_go-micro%E6%A1%86%E6%9E%B6%E4%BB%8B%E7%BB%8D.md">go-micro框架介绍</a></li>
<li><a href="https://www.topgoer.com/%E5%BE%AE%E6%9C%8D%E5%8A%A1/GoMicro%E5%85%A5%E9%97%A8.html">go-micro入门</a></li>
<li><a href="https://magodo.github.io/go-micro-tips/">go-micro 防坑指南</a></li>
<li><a href="https://www.lixueduan.com/categories/grpc/">grpc教程</a></li>
</ul>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content"><a href="https://piaohua.github.io/" class="theme-link">piaohua</a></span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
        2025-04-08
        
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">License</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/golang/">golang</a>
          <a href="/tags/go-micro/">go-micro</a>
          <a href="/tags/micro/">micro</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/learn/20250418-how-to-cook/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">学习如何在家看食材做菜</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/learn/20241216-cloudflare-redirect/">
            <span class="next-text nav-default">Cloudflare 将 example.com 重定向到 www.example.com</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

  
    <script src="https://giscus.app/client.js"
            data-repo="piaohua/piaohua.github.io"
            data-repo-id="MDEwOlJlcG9zaXRvcnkyODQ0MjQ4NDM="
            data-category="Announcements"
            data-category-id="DIC_kwDOEPP6i84ChN9S"
            data-mapping="pathname"
            data-strict="0"
            data-reactions-enabled="1"
            data-emit-metadata="0"
            data-input-position="bottom"
            data-theme="preferred_color_scheme"
            data-lang="zh-CN"
            crossorigin="anonymous"
            async>
    </script>

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:twopiao7@gmail.com" class="iconfont icon-email" title="email"></a>
      <a href="https://stackoverflow.com/" class="iconfont icon-stack-overflow" title="stack-overflow"></a>
      <a href="https://twitter.com/" class="iconfont icon-twitter" title="twitter"></a>
      <a href="https://facebook.com/" class="iconfont icon-facebook" title="facebook"></a>
      <a href="https://linkedin.com/" class="iconfont icon-linkedin" title="linkedin"></a>
      <a href="https://google.com/" class="iconfont icon-google" title="google"></a>
      <a href="https://github.com/piaohua/" class="iconfont icon-github" title="github"></a>
      <a href="https://weibo.com/" class="iconfont icon-weibo" title="weibo"></a>
      <a href="https://www.zhihu.com/people/piaohua-47" class="iconfont icon-zhihu" title="zhihu"></a>
      <a href="https://www.douban.com/people/47269566/" class="iconfont icon-douban" title="douban"></a>
      <a href="https://getpocket.com/" class="iconfont icon-pocket" title="pocket"></a>
      <a href="https://tumblr.com/" class="iconfont icon-tumblr" title="tumblr"></a>
      <a href="https://instagram.com/" class="iconfont icon-instagram" title="instagram"></a>
      <a href="https://gitlab.com/" class="iconfont icon-gitlab" title="gitlab"></a>
      <a href="https://www.bilibili.com/" class="iconfont icon-bilibili" title="bilibili"></a>
  <a href="https://piaohua.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2020 - 
    2025<span class="heart"><i class="iconfont icon-heart"></i></span><span><a href="https://piaohua.github.io/" class="theme-link">piaohua</a></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c12618f9a600c40bd024996677e951e64d3487006775aeb22e200c990006c5c7.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
